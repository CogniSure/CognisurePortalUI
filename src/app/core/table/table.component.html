<div class="generic-table">
  <div class="loader" *ngIf="showSpinner">
    <app-loader [showSpinner]="showSpinner"></app-loader>
  </div>
  <kendo-grid
    #generictable
    [kendoGridBinding]="gridView"
    kendoGridSelectBy="id"
    [(selectedKeys)]="mySelection"
    [pageSize]="10"
    [pageable]="true"
    [sortable]="true"
    [groupable]="true"
    [reorderable]="true"
    [resizable]="true"
    allowScrolling="true"
    scrollable="scrollable"
    [columnMenu]="{ filter: true }"
    [style.maxHeight.em]="height"
    [style.maxWidth]="'auto'"
    [loading]="loading"
    [selectable]="selectableSettings"
    [style]="'border-radius: 14px;overflow: hidden'"
  >
    <ng-template kendoGridToolbarTemplate>
      <kendo-textbox
        [style.width]="'25%'"
        [style.border.px]="2"
        placeholder="Search in all columns..."
        (valueChange)="onFilter($event)"
      >
        <span class="search-icon">&#128269;</span>
      </kendo-textbox>
      <kendo-grid-spacer></kendo-grid-spacer>

      <kendo-splitbutton [data]="export">
        <img
          src="../../../assets/images/download-icon.jpg"
          style="width: 30px; height: 30px"
          alt="Custom Icon"
        />
        <span class="export_psdxl"></span>

        <ng-template
          kendoSplitButtonItemTemplate
          let-dataItem
          style="width: 300px; height: 30%"
        >
          <!-- <div style="width:148%!important"> -->
          <button
            *ngIf="dataItem.text == 'excel'"
            kendoGridExcelCommand
            type="button"
            style="background-image: none"
          >
            <span class="export_xl"></span>
            <img
              class="excel_icon"
              src="../../../assets/images/XL.svg"
              style="width: 30px; height: 30px; padding-left: 10%"
            />
          </button>
          <button
            *ngIf="dataItem.text == 'pdf'"
            kendoGridPDFCommand
            style="background-image: none"
          >
            <span class="export_pdf"></span>
            <img
              class="pdf_icon"
              src="../../../assets/images/PDF.svg"
              style="width: 30px; height: 30px; padding-left: 10%"
            />
          </button>
          <!-- </div> -->
        </ng-template>
      </kendo-splitbutton>
    </ng-template>

    <ng-template ngFor [ngForOf]="columns" let-column>
      <kendo-grid-column
        *ngIf="column.type == 'text'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [editor]="column.editor"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <div
            [class.fixed-height-cell]="!cellExpansionState[rowIndex]"
            [class.expanded-cell]="cellExpansionState[rowIndex]"
            (click)="toggleCellExpansion(dataItem)"
          >
            {{ dataItem[column.field] }}
          </div>
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column
        *ngIf="column.type == 'link'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <a routerLink="/inbox/detail/summary" [ngStyle]="{ color: 'blue' }">
            {{ dataItem[column.field] }}</a
          >
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column
        *ngIf="column.type == 'checkbox'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
      >
        <ng-template
          kendoGridHeaderTemplate
          let-column
          let-columnIndex="columnIndex"
        >
          <input
            type="checkbox"
            kendoCheckBox
            [checked]="selectedCheckbox === columnIndex"
            (change)="onCheckboxChange(columnIndex)"
          />
        </ng-template>
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <input
            type="checkbox"
            kendoCheckBox
            [checked]="isSelected(dataItem)"
            (change)="onCheckBoxChange($event, dataItem)"
          />
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column
        *ngIf="column.type == 'icon'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <span class="k-icon k-i-import"></span>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column-group
        *ngIf="column.type == 'alerts'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [ngClass]="{ 'outputicon-class': true }"
      >
        <kendo-grid-column
          format="{{ column.format }}"
          [filterable]="column.filterable"
          [sortable]="column.sortable"
          [filter]="column.type"
          [width]="column.width"
          [columnMenu]="column.columnmenu"
          [width]="160"
        >
          <ng-template
            kendoGridHeaderTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            <div>
              <div style="text-align: center">
                {{ column.title }}
              </div>
              <!-- <hr class="solid"> -->
              <div class="image-row">
                <div *ngFor="let data of navData" class="image-container">
                  <img
                    [src]="data.imagePath"
                    style="padding: 0 0.25em 0 0.25em"
                    matTooltip="{{ data.label }}"
                  />
                </div>
              </div>
            </div>
          </ng-template>
          <ng-template
            kendoGridCellTemplate
            let-dataItem
            let-rowIndex="rowIndex"
            let-value="value"
          >
            <div style="display: flex; justify-content: center">
              <span
                *ngIf="dataItem.ExtractionComplete"
                class="k-icon k-i-circle"
                style="color: #6dc942"
              ></span>
              <span
                *ngIf="!dataItem.ExtractionComplete"
                class="k-icon k-i-circle"
                style="color: #80808059"
              ></span>

              <span class="k-icon k-i-circle" style="color: #80808059"></span>
              <span class="k-icon k-i-circle" style="color: #80808059"></span>
            </div>
          </ng-template>
        </kendo-grid-column>
      </kendo-grid-column-group>

      <kendo-grid-column
        *ngIf="column.type == 'SubmissionId'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [ngClass]="{ 'outputicon-class': true }"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
          style="width: 100%"
        >
          <ng-container>
            <a
              class="submissionid"
              routerLink="{{ column.redirectUrl }}"
              (click)="reDirect(column.redirectUrl, dataItem)"
              [ngStyle]="{ color: '#009CC1' }"
            >
              {{ dataItem[column.field] }}
              <span class="newtext" *ngIf="dataItem[column.IsNew]">New</span>
            </a>
            <span class="submissionicon"
              ><span class="k-icon k-i-email" (click)="togglePopup()"></span
            ></span>
          </ng-container>
          <ng-container class="popup-content">
            <kendo-popup
              *ngIf="isPopupVisible"
              [anchor]="popupAnchor"
              [popupClass]="'custom-popup'"
            >
              <button class="popup_closebtn" (click)="closePopup()">x</button>
              <app-emailpopup></app-emailpopup>
              <!-- <button (click)="closePopup()">Close Popup</button> -->
            </kendo-popup>
          </ng-container>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column
        *ngIf="column.type == 'DownloadXL'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [editor]="column.editor"
      >
        <ng-template kendoGridCellTemplate let-dataItem>
          <ng-container
            *ngIf="dataItem.Status === 'Completed'; else inProgressTemplate"
          >
            <a
              color="primary"
              class="excel_download"
              (click)="Download_Click(dataItem)"
            >
              <img
                src="../../../assets/images/execl_downloadimg.png"
                alt="Green Image"
              />
            </a>
          </ng-container>
          <ng-template #inProgressTemplate>
            <img
              src="../../../assets//images/disabled_excel.png"
              alt="Gray Image"
            />
          </ng-template>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column
        *ngIf="column.type == 'dropdown'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [editor]="column.editor"
      >
        <ng-template
          kendoGridEditTemplate
          let-dataItem="dataItem"
          let-formGroup="formGroup"
        >
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column
        *ngIf="column.type == 'priority'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [editor]="column.editor"
      >
        <ng-template
          kendoGridEditTemplate
          let-dataItem="dataItem"
          let-formGroup="formGroup"
        >
          <kendo-dropdownlist
            *ngIf="dataLoaded"
            [formControl]="formGroup.get(column.field)"
            [data]="dropdownData"
            [(ngModel)]="selectedValue"
            textField="label"
            valueField="value"
          ></kendo-dropdownlist>
        </ng-template>

        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <ng-container *ngIf="isCellEditable(dataItem, column)">
            <kendo-dropdownlist
              [data]="dropdownData"
              [ngModel]="selectedValue"
              (ngModelChange)="onDropdownChange(dataItem, $event)"
              textField="label"
              valueField="value"
            ></kendo-dropdownlist>
          </ng-container>
          <ng-container *ngIf="!isCellEditable(dataItem, column)">
            {{ dataItem[column.field] }}
          </ng-container>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column
        *ngIf="column.type == 'agencyname'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [editor]="column.editor"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <ng-container *ngIf="isCellEditable(dataItem, column)">
            <kendo-textbox [value]="dataItem[column.field]">{{
              dataItem[column.field]
            }}</kendo-textbox>
          </ng-container>
        </ng-template>

        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <div
            [class.fixed-height-cell]="!cellExpansionState[rowIndex]"
            [class.expanded-cell]="cellExpansionState[rowIndex]"
            (click)="toggleCellExpansion(dataItem)"
          >
            {{ dataItem[column.field] }}
          </div>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column
        *ngIf="column.type == 'LOB'"
        field="{{ column.field }}"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
      >
        <ng-template
          kendoGridCellTemplate
          let-dataItem
          let-rowIndex="rowIndex"
          let-value="value"
        >
          <div
            [class.fixed-height-cell]="!cellExpansionState[rowIndex]"
            [class.expanded-cell]="cellExpansionState[rowIndex]"
            (click)="toggleCellExpansion(dataItem)"
          >
            {{ dataItem[column.field] }}
            <span *ngIf="dataItem[column.field].extraData">{{
              dataItem[column.field].extraData
            }}</span>
          </div>
        </ng-template>
      </kendo-grid-column>

      <kendo-grid-column-group
        *ngIf="column.type == 'Outputs'"
        title="{{ column.title }}"
        format="{{ column.format }}"
        [filterable]="column.filterable"
        [sortable]="column.sortable"
        [filter]="column.type"
        [width]="column.width"
        [columnMenu]="column.columnmenu"
        [ngClass]="{ 'outputicon-class': true }"
      >
        >
        <kendo-grid-column
          field="{{ column.field }}"
          format="{{ column.format }}"
          [filterable]="column.filterable"
          [sortable]="column.sortable"
          [filter]="column.type"
          [width]="column.width"
          [columnMenu]="column.columnmenu"
          [width]="column.width"
        >
          <ng-template
            kendoGridHeaderTemplate
            let-column
            let-columnIndex="columnIndex"
            style="padding: 0"
            class="outputicon-class"
          >
            <img class="s360PendingimgPath" [src]="s360PendingimgPath" />
          </ng-template>
          <ng-template
            kendoGridCellTemplate
            let-dataItem
            let-rowIndex="rowIndex"
            let-value="value"
          >
            <div style="display: flex; width: 100%; justify-content: center">
              <div style="justify-content: center">
                <ng-container
                  *ngIf="dataItem.Status === 'Completed'; else S360Pending"
                >
                  <a
                    color="primary"
                    class="excel_download"
                    (click)="Download_Click(dataItem)"
                  >
                    <img
                      src="../../../assets/icons/S360ReportCompleted.svg"
                      alt="Green Image"
                    />
                  </a>
                </ng-container>
              </div>
              <ng-template #S360Pending>
                <img
                  src="../../../assets/icons/S360ReportPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #ConvaiPending>
                <img
                  src="../../../assets/icons/ConversationAIPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #InsgihtsPending>
                <img
                  src="../../../assets/icons/InsightsPending.svg"
                  alt="Gray Image"
                />
              </ng-template>
            </div>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="{{ column.field }}"
          format="{{ column.format }}"
          [filterable]="column.filterable"
          [sortable]="column.sortable"
          [filter]="column.type"
          [width]="column.width"
          [columnMenu]="column.columnmenu"
          [width]="column.width"
          title=""
          field="subColumn1"
          [ngClass]="{ outputicon_clum: true }"
          [style]="{ 'border-radius': '0' }"
        >
          <ng-template
            kendoGridHeaderTemplate
            let-column
            let-columnIndex="columnIndex"
            style="padding: 0"
            class="outputicon-class"
          >
            <img class="convaiPendingimgPath" [src]="convaiPendingimgPath" />
          </ng-template>
          <ng-template
            kendoGridCellTemplate
            let-dataItem
            let-rowIndex="rowIndex"
            let-value="value"
          >
            <div style="display: flex; width: 100%; justify-content: center">
              <div style="justify-content: center">
                <ng-container
                  *ngIf="dataItem.Status === 'Completed'; else ConvaiPending"
                >
                  <kendo-button
                    class="copied_icontop"
                    style="
                      background: transparent;
                      border: none;
                      height: 100%;
                      width: 100%;
                      padding: 0;
                      margin: 0;
                    "
                    (click)="Copilot_Click(dataItem)"
                  >
                    <img
                      src="../../../assets/icons/ConversationAICompleted.svg"
                      alt="Green Image"
                    />
                  </kendo-button>
                </ng-container>
              </div>

              <ng-template #S360Pending>
                <img
                  src="../../../assets/icons/S360ReportPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #ConvaiPending>
                <img
                  src="../../../assets/icons/ConversationAIPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #InsgihtsPending>
                <img
                  src="../../../assets/icons/InsightsPending.svg"
                  alt="Gray Image"
                />
              </ng-template>
            </div>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="{{ column.field }}"
          format="{{ column.format }}"
          [filterable]="column.filterable"
          [sortable]="column.sortable"
          [filter]="column.type"
          [width]="column.width"
          [columnMenu]="column.columnmenu"
          [width]="column.width"
          title=""
          field=""
          [ngClass]="{ outputicon_clum: true }"
          [style]="{ 'border-radius': '0' }"
        >
          <ng-template
            kendoGridHeaderTemplate
            let-column
            let-columnIndex="columnIndex"
            style="padding: 0"
            class="outputicon-class"
          >
            <img class="insgihtsPending" [src]="insgihtsPending" />
          </ng-template>
          <ng-template
            kendoGridCellTemplate
            let-dataItem
            let-rowIndex="rowIndex"
            let-value="value"
          >
            <div style="display: flex; width: 100%; justify-content: center">
              <div style="width: 25%; justify-content: center">
                <ng-container
                  *ngIf="dataItem.Status === 'Completed'; else InsgihtsPending"
                >
                  <a
                    color="primary"
                    class="excel_download"
                    (click)="Download_Click(dataItem)"
                  >
                    <img
                      src="../../../assets/icons/InsightsCompleted.svg"
                      alt="Green Image"
                    />
                  </a>
                </ng-container>
              </div>
              <ng-template #S360Pending>
                <img
                  src="../../../assets/icons/S360ReportPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #ConvaiPending>
                <img
                  src="../../../assets/icons/ConversationAIPending.svg"
                  alt="Gray Image"
                />
              </ng-template>

              <ng-template #InsgihtsPending>
                <img
                  src="../../../assets/icons/InsightsPending.svg"
                  alt="Gray Image"
                />
              </ng-template>
            </div>
          </ng-template>
        </kendo-grid-column>
      </kendo-grid-column-group>
    </ng-template>
    <ng-template kendoGridLoadingTemplate>
      <div class="k-loading-color"></div>
      <div class="loading-container">
        <kendo-loader type="converging-spinner" size="large"></kendo-loader>
      </div>
    </ng-template>
    <kendo-grid-pdf
      fileName="Employees.pdf"
      [repeatHeaders]="true"
    ></kendo-grid-pdf>
    <kendo-grid-excel fileName="Employees.xlsx"></kendo-grid-excel>
  </kendo-grid>
</div>
